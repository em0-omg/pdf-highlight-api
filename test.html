<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Highlight API - Test Client</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .upload-section {
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        margin-bottom: 20px;
      }
      .file-input {
        margin: 20px 0;
      }
      input[type="file"] {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        width: 100%;
        box-sizing: border-box;
      }
      .upload-btn {
        background-color: #007bff;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }
      .upload-btn:hover {
        background-color: #0056b3;
      }
      .upload-btn:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      .status {
        margin-top: 20px;
        padding: 10px;
        border-radius: 5px;
        display: none;
      }
      .status.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.loading {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .download-link {
        display: inline-block;
        margin-top: 10px;
        padding: 8px 16px;
        background-color: #28a745;
        color: white;
        text-decoration: none;
        border-radius: 5px;
      }
      .download-link:hover {
        background-color: #218838;
      }
      .info {
        background-color: #e7f3ff;
        border-left: 4px solid #007bff;
        padding: 15px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>PDF Highlight API - Test Client</h1>

      <div class="info">
        <strong>ä½¿ç”¨æ–¹æ³•:</strong><br />
        1. PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ<br />
        2. "Upload & Highlight" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯<br />
        3. å‡¦ç†å®Œäº†å¾Œã€ãƒã‚¤ãƒ©ã‚¤ãƒˆæ¸ˆã¿PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      </div>

      <div class="upload-section">
        <h3>ğŸ“„ PDF ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
        <div class="file-input">
          <input type="file" id="pdfFile" accept=".pdf" />
        </div>
        <button class="upload-btn" id="uploadBtn" onclick="uploadPDF()">
          Upload & Highlight
        </button>
      </div>

      <div class="status" id="status"></div>
    </div>

    <script>
      const API_BASE_URL = "http://localhost:8000";

      function showStatus(message, type) {
        const statusDiv = document.getElementById("status");
        statusDiv.textContent = message;
        statusDiv.className = `status ${type}`;
        statusDiv.style.display = "block";
      }

      function hideStatus() {
        const statusDiv = document.getElementById("status");
        statusDiv.style.display = "none";
      }

      async function uploadPDF() {
        const fileInput = document.getElementById("pdfFile");
        const uploadBtn = document.getElementById("uploadBtn");

        if (!fileInput.files[0]) {
          showStatus("PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„", "error");
          return;
        }

        const file = fileInput.files[0];
        if (!file.name.toLowerCase().endsWith(".pdf")) {
          showStatus("PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„", "error");
          return;
        }

        uploadBtn.disabled = true;
        uploadBtn.textContent = "Processing...";
        showStatus("PDFã‚’å‡¦ç†ä¸­...", "loading");

        const formData = new FormData();
        formData.append("file", file);

        try {
          const response = await fetch(`${API_BASE_URL}/highlight-pdf`, {
            method: "POST",
            body: formData,
          });

          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const originalName = file.name.replace(".pdf", "");
            const downloadName = `highlighted_${originalName}.pdf`;

            showStatus(
              "å‡¦ç†å®Œäº†ï¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚",
              "success"
            );

            const downloadLink = document.createElement("a");
            downloadLink.href = url;
            downloadLink.download = downloadName;
            downloadLink.className = "download-link";
            downloadLink.textContent = `ğŸ“¥ ${downloadName} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰`;

            const statusDiv = document.getElementById("status");
            statusDiv.appendChild(document.createElement("br"));
            statusDiv.appendChild(downloadLink);
          } else {
            const errorData = await response.json();
            showStatus(`ã‚¨ãƒ©ãƒ¼: ${errorData.detail}`, "error");
          }
        } catch (error) {
          console.error("Error:", error);
          showStatus(
            "APIã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
            "error"
          );
        } finally {
          uploadBtn.disabled = false;
          uploadBtn.textContent = "Upload & Highlight";
        }
      }

      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®å‡¦ç†
      document
        .getElementById("pdfFile")
        .addEventListener("change", function (e) {
          hideStatus();
          if (e.target.files[0]) {
            const fileName = e.target.files[0].name;
            console.log("Selected file:", fileName);
          }
        });

      // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã®å‡¦ç†
      const uploadSection = document.querySelector(".upload-section");

      uploadSection.addEventListener("dragover", function (e) {
        e.preventDefault();
        uploadSection.style.borderColor = "#007bff";
        uploadSection.style.backgroundColor = "#f8f9fa";
      });

      uploadSection.addEventListener("dragleave", function (e) {
        e.preventDefault();
        uploadSection.style.borderColor = "#ddd";
        uploadSection.style.backgroundColor = "white";
      });

      uploadSection.addEventListener("drop", function (e) {
        e.preventDefault();
        uploadSection.style.borderColor = "#ddd";
        uploadSection.style.backgroundColor = "white";

        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].name.toLowerCase().endsWith(".pdf")) {
          document.getElementById("pdfFile").files = files;
          hideStatus();
        } else {
          showStatus("PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„", "error");
        }
      });
    </script>
  </body>
</html>
